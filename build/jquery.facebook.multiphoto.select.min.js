/**
 * jQuery Facebook Multi-Photo Selector (jfmps)
 * https://github.com/seanhellwig/jQuery-Facebook-Multi-Photo-Selector
 * Allows the selection of Facebook album photos 
 * @author Sean Hellwig
 * Inspired by: https://github.com/mbrevoort/jquery-facebook-multi-friend-selector - thanks for some css :)
 * @dependencies jQuery 1.4.4+ http://jquery.com/
 * License: MIT
**/
window.log=function(){log.history=log.history||[];log.history.push(arguments);this.console&&console.log(Array.prototype.slice.call(arguments))};
(function(b){var s=function(q,g){var d=b(q);d.append(b('<div id="jfmps-inner-header"><div id="jfmps-breadcrumb"><span id="jfmps-default-crumb">Albums</span><span id="jfmps-crumb-separator">&raquo;</span><span id="jfmps-photos-list-crumb"></span></div><a class="jfmps-meta" id="jfmps-num-selected" href="javascript:void(0);">Selected (<span id="jfmps-selected-count">0</span>)</a><a class="jfmps-meta" id="jfmps-clear-button" href="javascript:void(0);">Clear Selected Images</a></div><div id="jfmps-album-covers"></div><div id="jfmps-album-photos"></div><div id="jfmps-selected-container"><h3>Selected Photos</h3><div id="jfmps-selected-photos"></div></div>'));var k=
b("#jfmps-album-covers",d),h=b("#jfmps-album-photos",d),l=b("#jfmps-selected-photos",d),m=b("#jfmps-selected-count",d),n=b("#jfmps-photos-list-crumb",d),r=b("#jfmps-crumb-separator",d),o=b("#jfmps-clear-button",d),c={maxPhotosSelected:10,numAlbumColumns:4,numPhotosColumns:6,imageSubmitButton:b("#jfmps-submit-button"),submitCallback:function(a){alert(a)},noAlbumImagesText:"You have no images in this album.",noAlbumsText:"You do not have any albums.",selectedImageCallback:null,debug:!1},p,i,e=0,c=b.extend(!0,
c,g||{}),s=function(a){c.debug&&log(a);if(a.data&&a.data.length>0){var a=a.data,b;p={};i={};n.hide();r.hide();h.hide();c.imageSubmitButton.bind("click",v);o.bind("click",t);for(b=0;b<a.length;b++)((b+1)%c.numAlbumColumns===1||c.numAlbumColumns===1)&&k.append('<div class="image-row" />'),w(a[b])}else d.append("<h2>"+c.noAlbumsText+"</h2>")},w=function(a){var c=b('<div id="fb-albumcover-'+a.id+'" class="jfmps-albumcover" />');c.data("album_id",a.id);var d=b('<div class="jfmps-albumname" />').text(a.name),
f=b('<img width="50" src="https://graph.facebook.com/'+a.id+"/picture?access_token="+FB.getSession().access_token+'&amp;type=thumbnail" />');c.append(f);c.append(d);c.bind("click",function(b){x(b,c,a.name)});b("div.image-row",k).last().append(c)},x=function(a,b,d){var f=b.data("album_id");n.empty().html("{album_name} [X]".replace("{album_name}",d));p[f]===void 0?FB.api("/"+f+"/photos",function(a){c.debug&&log(a);p[f]=a.data;u(f)}):u(f)},u=function(a){var a=p[a],d;if(a.length>0)for(d=0;d<a.length;d++){(d+
1)%c.numPhotosColumns===1&&h.append('<div class="image-row" />');var e=b('<div id="fb-albumimage-'+a[d].id+'" class="jfmps-albumimage" />');e.data("image_id",a[d].id);i[a[d].id]!==void 0&&e.addClass("selected");var f=b('<img width="75" src="https://graph.facebook.com/'+a[d].id+"/picture?access_token="+FB.getSession().access_token+'&amp;type=thumbnail" />');e.append(f);b("div.image-row",h).last().append(e);y(e,a[d].images)}else h.append("<h2>"+c.noAlbumImagesText+"</h2>");n.bind("click",z).show();
r.show();k.hide();h.show()},y=function(a,d){var h=a.data("image_id");a.bind("click",function(){if(i[h]===void 0){if(e<c.maxPhotosSelected){i[h]=d;a.addClass("selected");var f=b("img",a),j=a.data("image_id"),j=b('<li id="selected-'+j+'"/>'),g;b("ul",l).length<=0?(g=b("<ul/>"),l.append(g)):g=b("ul",l);f.clone().appendTo(j);g.append(j);e+=1;m.html(e+" / "+c.maxPhotosSelected);c.selectedImageCallback!==null&&c.selectedImageCallback()}}else a.removeClass("selected"),delete i[h],f=a.data("image_id"),j=
b("ul",l).eq(0),b("li#selected-"+f,j).remove(),e-=1,m.html(e+" / "+c.maxPhotosSelected);e>0?(c.imageSubmitButton.show(),o.show()):(c.imageSubmitButton.hide(),o.hide())})},z=function(){h.empty().hide();n.unbind("click").hide();r.hide();k.show()},v=function(){if(e>0){var a=e>0?JSON.stringify(i):!1;c.debug&&log(a);c.submitCallback&&c.submitCallback(a)}},t=function(){for(var a in i)i.hasOwnProperty(a)&&(delete i[a],b("#fb-albumimage-"+a,d).removeClass("selected"),b("li#selected-"+a,d).remove());e=0;m.html(e);
o.hide()};c.numAlbumColumns<1||c.numPhotosColumns<1?c.debug&&log("settings.numAlbumColumns & settings.numPhotosColumns must be greater than 0"):(m.html(e+" / "+c.maxPhotosSelected),FB.api("/me/albums",s));return{clearSelectedImages:function(){t()},getSelectedImages:function(){e>0&&JSON.stringify(i)}}};b.fn.jfmps=function(q){return this.each(function(){var g=b(this),d;if(g.data("jfmps"))return g.data("jfmps");d=new s(this,q);g.data("jfmps",d);return this})}})(jQuery);
